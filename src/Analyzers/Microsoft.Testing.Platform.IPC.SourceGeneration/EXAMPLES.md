# Example: Generated Serializer Output

This file shows what the source generator would produce for a simple Request type.

## Input Source Code

**TestHostProcessPIDRequest.cs:**
```csharp
using Microsoft.CodeAnalysis;
using Microsoft.Testing.Platform.IPC;

namespace Microsoft.Testing.Platform.IPC.Models;

[Embedded]
[GenerateSerializer(2)]  // Added this attribute
internal sealed class TestHostProcessPIDRequest(int pid) : IRequest
{
    public int PID { get; } = pid;
}
```

## Generated Output

**TestHostProcessPIDRequestSerializer.g.cs:** (Auto-generated)
```csharp
// <auto-generated/>

#nullable enable

using System;
using System.IO;
using System.Text;
using Microsoft.Testing.Platform.IPC;
using Microsoft.Testing.Platform.IPC.Serializers;

namespace Microsoft.Testing.Platform.IPC.Models
{
    internal sealed class TestHostProcessPIDRequestSerializer : BaseSerializer, INamedPipeSerializer
    {
        public int Id => 2;

        public object Deserialize(Stream stream)
        {
            return new TestHostProcessPIDRequest(
                ReadInt(stream));
        }

        public void Serialize(object objectToSerialize, Stream stream)
        {
            var request = (TestHostProcessPIDRequest)objectToSerialize;
            WriteInt(stream, request.PID);
        }
    }
}
```

## Comparison with Manual Implementation

### Manual Version (Current)
**File:** `src/Platform/Microsoft.Testing.Platform/IPC/Serializers/TestHostProcessPIDRequestSerializer.cs`

```csharp
using Microsoft.CodeAnalysis;
using Microsoft.Testing.Platform.IPC.Models;

namespace Microsoft.Testing.Platform.IPC.Serializers;

[Embedded]
internal sealed class TestHostProcessPIDRequestSerializer : BaseSerializer, INamedPipeSerializer
{
    public int Id => TestHostProcessPIDRequestFieldsId.MessagesSerializerId;

    public object Deserialize(Stream stream)
    {
        int pid = ReadInt(stream);
        return new TestHostProcessPIDRequest(pid);
    }

    public void Serialize(object obj, Stream stream)
    {
        var testHostProcessPIDRequest = (TestHostProcessPIDRequest)obj;
        WriteInt(stream, testHostProcessPIDRequest.PID);
    }
}
```

### Generated Version
- Same functionality
- No manual coding required
- Automatically updated when properties change
- Consistent pattern across all serializers
- Less error-prone

## More Examples

### Example: RunSummaryInfoRequest (Multiple Fields)

**Input:**
```csharp
namespace Microsoft.Testing.Extensions.MSBuild.Serializers;

[GenerateSerializer(3)]
internal sealed record RunSummaryInfoRequest(
    int Total,
    int TotalFailed,
    int TotalPassed,
    int TotalSkipped,
    string? Duration) : IRequest;
```

**Generated:**
```csharp
// <auto-generated/>

#nullable enable

using System;
using System.IO;
using System.Text;
using Microsoft.Testing.Platform.IPC;
using Microsoft.Testing.Platform.IPC.Serializers;

namespace Microsoft.Testing.Extensions.MSBuild.Serializers
{
    internal sealed class RunSummaryInfoRequestSerializer : BaseSerializer, INamedPipeSerializer
    {
        public int Id => 3;

        public object Deserialize(Stream stream)
        {
            return new RunSummaryInfoRequest(
                ReadInt(stream),
                ReadInt(stream),
                ReadInt(stream),
                ReadInt(stream),
                ReadString(stream));
        }

        public void Serialize(object objectToSerialize, Stream stream)
        {
            var request = (RunSummaryInfoRequest)objectToSerialize;
            WriteInt(stream, request.Total);
            WriteInt(stream, request.TotalFailed);
            WriteInt(stream, request.TotalPassed);
            WriteInt(stream, request.TotalSkipped);
            WriteString(stream, request.Duration ?? string.Empty);
        }
    }
}
```

### Example: Empty Request

**Input:**
```csharp
namespace Microsoft.Testing.Extensions.HangDump.Serializers;

[GenerateSerializer(2)]
internal sealed class SessionEndSerializerRequest : IRequest;
```

**Generated:**
```csharp
// <auto-generated/>

#nullable enable

using System;
using System.IO;
using System.Text;
using Microsoft.Testing.Platform.IPC;
using Microsoft.Testing.Platform.IPC.Serializers;

namespace Microsoft.Testing.Extensions.HangDump.Serializers
{
    internal sealed class SessionEndSerializerRequestSerializer : BaseSerializer, INamedPipeSerializer
    {
        public int Id => 2;

        public object Deserialize(Stream stream)
        {
            return new SessionEndSerializerRequest();
        }

        public void Serialize(object objectToSerialize, Stream stream)
        {
            // Empty request/response - nothing to serialize
        }
    }
}
```

## Integration

To use the generated serializers, the Microsoft.Testing.Platform project would need to:

1. Add a project reference to the source generator:
```xml
<ItemGroup>
  <ProjectReference Include="..\..\Analyzers\Microsoft.Testing.Platform.IPC.SourceGeneration\Microsoft.Testing.Platform.IPC.SourceGeneration.csproj"
                    OutputItemType="Analyzer"
                    ReferenceOutputAssembly="false" />
</ItemGroup>
```

2. Apply `[GenerateSerializer]` to Request/Response types
3. Remove manual serializer implementations
4. The build process automatically generates the serializers

## Benefits Summary

1. **Reduced Maintenance**: ~20-30 lines of code saved per serializer Ã— 24 serializers = ~500 lines
2. **Fewer Bugs**: Eliminates human error in read/write ordering
3. **Consistency**: All serializers follow the same pattern
4. **Refactoring Safety**: Renaming properties is safer with generated code
5. **Onboarding**: New developers don't need to learn serialization patterns
