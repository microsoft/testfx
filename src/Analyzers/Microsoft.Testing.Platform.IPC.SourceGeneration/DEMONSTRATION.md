# Concrete Demonstration: TestHostProcessPIDRequest

This file shows a side-by-side comparison of the current manual implementation versus what would be generated by the source generator.

## Current Implementation (Manual)

### File 1: TestHostProcessPIDRequest.cs
**Location:** `src/Platform/Microsoft.Testing.Platform/IPC/Models/TestHostProcessPIDRequest.cs`

```csharp
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.

using Microsoft.CodeAnalysis;

namespace Microsoft.Testing.Platform.IPC.Models;

[Embedded]
internal sealed class TestHostProcessPIDRequest(int pid) : IRequest
{
    public int PID { get; } = pid;
}
```

### File 2: TestHostProcessPIDRequestSerializer.cs (MANUAL)
**Location:** `src/Platform/Microsoft.Testing.Platform/IPC/Serializers/TestHostProcessPIDRequestSerializer.cs`

```csharp
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.

using Microsoft.CodeAnalysis;
using Microsoft.Testing.Platform.IPC.Models;

namespace Microsoft.Testing.Platform.IPC.Serializers;

[Embedded]
internal sealed class TestHostProcessPIDRequestSerializer : BaseSerializer, INamedPipeSerializer
{
    public int Id => TestHostProcessPIDRequestFieldsId.MessagesSerializerId;

    public object Deserialize(Stream stream)
    {
        int pid = ReadInt(stream);
        return new TestHostProcessPIDRequest(pid);
    }

    public void Serialize(object obj, Stream stream)
    {
        var testHostProcessPIDRequest = (TestHostProcessPIDRequest)obj;
        WriteInt(stream, testHostProcessPIDRequest.PID);
    }
}
```

### File 3: ObjectFieldIds.cs
**Location:** `src/Platform/Microsoft.Testing.Platform/ServerMode/DotnetTest/IPC/ObjectFieldIds.cs`

```csharp
internal static class TestHostProcessPIDRequestFieldsId
{
    public const int MessagesSerializerId = 2;
}
```

---

## With Source Generator (Automated)

### File 1: TestHostProcessPIDRequest.cs (MODIFIED)
**Location:** `src/Platform/Microsoft.Testing.Platform/IPC/Models/TestHostProcessPIDRequest.cs`

```csharp
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.

using Microsoft.CodeAnalysis;

namespace Microsoft.Testing.Platform.IPC.Models;

[Embedded]
[GenerateSerializer(TestHostProcessPIDRequestFieldsId.MessagesSerializerId)]  // ← ADDED THIS LINE
internal sealed class TestHostProcessPIDRequest(int pid) : IRequest
{
    public int PID { get; } = pid;
}
```

### File 2: TestHostProcessPIDRequestSerializer.g.cs (AUTO-GENERATED)
**Location:** Generated at compile time in `obj/` directory

```csharp
// <auto-generated/>

#nullable enable

using System;
using System.IO;
using System.Text;
using Microsoft.Testing.Platform.IPC;
using Microsoft.Testing.Platform.IPC.Serializers;

namespace Microsoft.Testing.Platform.IPC.Models
{
    internal sealed class TestHostProcessPIDRequestSerializer : BaseSerializer, INamedPipeSerializer
    {
        public int Id => 2;

        public object Deserialize(Stream stream)
        {
            return new TestHostProcessPIDRequest(
                ReadInt(stream));
        }

        public void Serialize(object objectToSerialize, Stream stream)
        {
            var request = (TestHostProcessPIDRequest)objectToSerialize;
            WriteInt(stream, request.PID);
        }
    }
}
```

### File 3: ObjectFieldIds.cs (UNCHANGED)
**Location:** `src/Platform/Microsoft.Testing.Platform/ServerMode/DotnetTest/IPC/ObjectFieldIds.cs`

```csharp
internal static class TestHostProcessPIDRequestFieldsId
{
    public const int MessagesSerializerId = 2;
}
```

### File 4: TestHostProcessPIDRequestSerializer.cs (DELETED)
~~`src/Platform/Microsoft.Testing.Platform/IPC/Serializers/TestHostProcessPIDRequestSerializer.cs`~~

❌ **This file can be deleted!** The serializer is now auto-generated.

---

## Changes Summary

### What Changes:
1. ✅ Add `[GenerateSerializer(2)]` attribute to `TestHostProcessPIDRequest.cs`
2. ❌ Delete `TestHostProcessPIDRequestSerializer.cs` (no longer needed)
3. ✅ Serializer is auto-generated at compile time

### What Stays the Same:
- Registration code unchanged
- ObjectFieldIds.cs unchanged
- All consuming code unchanged
- Binary serialization format unchanged

### Benefits:
- **-25 lines of manual code** (entire serializer file deleted)
- **Zero risk of bugs** in serialization logic
- **Automatic updates** when properties change
- **Consistent pattern** across all serializers

---

## More Examples

### Example 2: VoidResponse

**Current (Manual):**
```csharp
// VoidResponse.cs
internal sealed class VoidResponse : IResponse;

// VoidResponseSerializer.cs - 20 lines
internal sealed class VoidResponseSerializer : BaseSerializer, INamedPipeSerializer
{
    public int Id => VoidResponseFieldsId.MessagesSerializerId;
    public object Deserialize(Stream stream) => new VoidResponse();
    public void Serialize(object _, Stream __) { }
}
```

**With Generator:**
```csharp
// VoidResponse.cs
[GenerateSerializer(0)]
internal sealed class VoidResponse : IResponse;

// VoidResponseSerializer.cs deleted - auto-generated!
```

### Example 3: ModuleInfoRequest

**Current (Manual):**
```csharp
// ModuleInfoRequest.cs
internal sealed record ModuleInfoRequest(
    string FrameworkDescription,
    string ProcessArchitecture,
    string TestResultFolder) : IRequest;

// ModuleInfoRequestSerializer.cs - 18 lines
internal sealed class ModuleInfoRequestSerializer : BaseSerializer, INamedPipeSerializer
{
    public int Id => 1;
    
    public object Deserialize(Stream stream)
        => new ModuleInfoRequest(ReadString(stream), ReadString(stream), ReadString(stream));
    
    public void Serialize(object objectToSerialize, Stream stream)
    {
        var moduleInfo = (ModuleInfoRequest)objectToSerialize;
        WriteString(stream, moduleInfo.FrameworkDescription);
        WriteString(stream, moduleInfo.ProcessArchitecture);
        WriteString(stream, moduleInfo.TestResultFolder);
    }
}
```

**With Generator:**
```csharp
// ModuleInfoRequest.cs
[GenerateSerializer(1)]
internal sealed record ModuleInfoRequest(
    string FrameworkDescription,
    string ProcessArchitecture,
    string TestResultFolder) : IRequest;

// ModuleInfoRequestSerializer.cs deleted - auto-generated!
```

---

## Impact Across Repository

### Eligible for Full Automation (Simple Types):
- ✅ `TestHostProcessPIDRequest` (1 property)
- ✅ `TestHostProcessExitRequest` (0 properties)
- ✅ `VoidResponse` (0 properties)
- ✅ `SessionEndSerializerRequest` (0 properties)
- ✅ `ConsumerPipeNameRequest` (1 property)
- ✅ `ActivityIndicatorMutexNameRequest` (1 property)
- ✅ `ModuleInfoRequest` (3 properties)
- ✅ `RunSummaryInfoRequest` (5 properties)
- ✅ `FailedTestInfoRequest` (multiple simple properties)
- ✅ `FailedTestRequest` (1 property)
- ✅ `GetListOfFailedTests` (0 properties)
- ✅ `GetListOfFailedTestsResponse` (1 property)
- ✅ `TotalTestsRunRequest` (1 property)
- ✅ `ReportFileNameRequest` (1 property)
- ✅ `TestAdapterInformationsRequest` (simple properties)

**Estimated Impact:** ~15-18 serializers fully automated = ~300-450 lines of code eliminated

### Needs Manual Implementation (Complex Types):
- ⚠️ `CommandLineOptionMessages` (nested arrays)
- ⚠️ `DiscoveredTestMessages` (complex nested structure)
- ⚠️ `TestResultMessages` (complex nested structure)
- ⚠️ `FileArtifactMessages` (arrays)
- ⚠️ `TestSessionEvent` (may have complex logic)
- ⚠️ `HandshakeMessage` (dictionary property)

**Note:** Generator creates stubs for these with TODO comments as starting templates
