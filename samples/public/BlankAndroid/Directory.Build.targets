<Project>
  <!-- For device projects, override the error check -->
  <PropertyGroup>
    <SkipVSTestError Condition="$(TargetFramework.Contains('android')) OR $(TargetFramework.Contains('ios'))">true</SkipVSTestError>
  </PropertyGroup>

  <!-- Override _MTPBeforeVSTest to skip the error for device projects -->
  <Target Name="_MTPBeforeVSTest" BeforeTargets="VSTest">
    <PropertyGroup>
      <_SdkMajorVersion>$(NETCoreSdkVersion.Split('.')[0])</_SdkMajorVersion>
      <_SupportsGlobalJsonTestRunner Condition="'$(NETCoreSdkVersion)' != '' AND '$(_SdkMajorVersion)' >= '10'">true</_SupportsGlobalJsonTestRunner>
    </PropertyGroup>

    <!-- Show error only for non-device projects -->
    <Error Text="Testing with VSTest target is no longer supported by Microsoft.Testing.Platform on .NET 10 SDK and later. If you use dotnet test, you should opt-in to the new dotnet test experience. For more information, see https://aka.ms/dotnet-test-mtp-error"
           Condition="'$(IsTestingPlatformApplication)'=='true' AND '$(TargetFramework)'!='' AND '$(_SupportsGlobalJsonTestRunner)'=='true' AND '$(SkipVSTestError)'!='true'" />

    <CallTarget Condition="'$(VSTestNoBuild)' != 'true' AND '$(TargetFramework)'!=''" Targets="BuildProject" />
  </Target>

  <!-- Override VSTest target for device projects to show status -->
  <Target Name="VSTest" Condition="'$(SkipVSTestError)' == 'true'">
    <Message Text="=== Device Testing Status ===" Importance="high" />
    <Message Text="Project: $(MSBuildProjectName)" Importance="high" />
    <Message Text="Target Framework: $(TargetFramework)" Importance="high" />
    <Message Text="" Importance="high" />
    <Message Text="âœ… Build completed successfully!" Importance="high" />
    <Message Text="ðŸ“¦ APK generated: bin\Debug\$(TargetFramework)\$(ApplicationId)-Signed.apk" Importance="high" />
    <Message Text="" Importance="high" />
    <Message Text="âš ï¸  Device test execution is in development." Importance="high" />
    <Message Text="   Components are implemented but MSBuild wiring is incomplete." Importance="high" />
    <Message Text="" Importance="high" />
    <Message Text="Manual deployment:" Importance="high" />
    <Message Text="  adb install -r bin\Debug\$(TargetFramework)\$(ApplicationId)-Signed.apk" Importance="high" />
    <Message Text="" Importance="high" />
    <Message Text="See: DEVICE_TESTING_DOTNET_TEST_STATUS.md" Importance="high" />
    <Message Text="============================" Importance="high" />
  </Target>
</Project>
